
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vietnam → Destinations (Flags + Label Toggle)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  html, body, #map { height: 100%; margin: 0; }
  .panel {
    position: absolute; top: 56px; right: 12px; width: 380px;
    max-height: calc(100% - 68px); overflow: auto;
    background: rgba(255,255,255,0.96); border-radius: 12px; 
    box-shadow: 0 8px 30px rgba(0,0,0,.12); padding: 12px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    z-index: 1000; transition: transform .2s ease, opacity .2s ease;
  }
  .panel.hidden { transform: translateY(-8px); opacity: 0; pointer-events: none; }
  .panel h2 { margin: 4px 0 10px 0; font-size: 16px; }
  .row { display: grid; grid-template-columns: 1.1fr 1.9fr; gap: 6px; align-items: center; margin-bottom: 6px; }
  .row label { font-size: 12px; font-weight: 600; color: #333; }
  .row input[type="text"] { width: 100%; font-size: 12px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 8px; }
  .btnbar { display: flex; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
  button { padding: 8px 10px; border: 0; border-radius: 8px; background: #1e88e5; color: white; font-weight: 600; cursor: pointer; }
  button.secondary { background: #e0e0e0; color: #222; }
  .toggle {
    position: absolute; top: 12px; right: 12px; z-index: 1100;
    background: #1e88e5; color: #fff; border: 0; border-radius: 999px;
    padding: 10px 14px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 30px rgba(0,0,0,.15);
  }
  .note { font-size: 12px; color: #555; margin-top: 8px; line-height: 1.3; }
  .dest-label { color: #1e88e5; font-weight: 800; text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff; }
  .origin-label { color: #d32f2f; font-weight: 900; text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff; }
  .leaflet-tooltip { background: transparent; border: 0; box-shadow: none; }
  .flag-icon img { width: 28px; height: 28px; border-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,.25); }
  /* Label toggle: when body has .labels-off, all Leaflet tooltips are hidden */
  body.labels-off .leaflet-tooltip { display: none !important; }
</style>
</head>
<body>
<div id="map"></div>
<button id="togglePanel" class="toggle">Hide list ▴</button>
<div class="panel" id="panel">
  <h2>Editable icons per country</h2>
  <div id="inputs"></div>
  <div class="btnbar">
    <button id="applyBtn">Apply changes</button>
    <button id="resetBtn" class="secondary">Reset</button>
    <button id="exportBtn" class="secondary">Export JSON</button>
    <button id="toggleLabelsBtn" class="secondary">Hide labels</button>
  </div>
  <div class="note">
    Prefilled with flag icons (icons8). Paste any image URL (PNG/SVG). Saved to <b>localStorage</b>.<br/>
    This build adds a <b>Hide/Show labels</b> toggle.
  </div>
  <textarea id="exportBox" style="width:100%;height:80px;margin-top:8px;display:none;"></textarea>
</div>

<script>
  const STORAGE_KEY = "iconConfig_vn_routes_v1";
  const LABELS_KEY = "labelsHidden_v1";
  const lineColor = "#1e88e5";

  // Origin (Vietnam) with flag
  const origin = { name: "Vietnam", lat: 14.0583, lng: 108.2772, flag: "https://img.icons8.com/emoji/48/vietnam-emoji.png" };

  // Countries with flags
  const countries = [
    { name: "Australia", lat: -25.2744, lng: 133.7751, flag: "https://img.icons8.com/emoji/48/australia-emoji.png" },
    { name: "Belarus", lat: 53.7098, lng: 27.9534, flag: "https://img.icons8.com/emoji/48/belarus-emoji.png" },
    { name: "Brunei", lat: 4.5353, lng: 114.7277, flag: "https://img.icons8.com/emoji/48/brunei-emoji.png" },
    { name: "Cambodia", lat: 12.5657, lng: 104.9910, flag: "https://img.icons8.com/emoji/48/cambodia-emoji.png" },
    { name: "Canada", lat: 56.1304, lng: -106.3468, flag: "https://img.icons8.com/emoji/48/canada-emoji.png" },
    { name: "China", lat: 35.8617, lng: 104.1954, flag: "https://img.icons8.com/emoji/48/china-emoji.png" },
    { name: "Cuba", lat: 21.5218, lng: -77.7812, flag: "https://img.icons8.com/emoji/48/cuba-emoji.png" },
    { name: "Greece", lat: 39.0742, lng: 21.8243, flag: "https://img.icons8.com/emoji/48/greece-emoji.png" },
    { name: "Finland", lat: 61.9241, lng: 25.7482, flag: "https://img.icons8.com/emoji/48/finland-emoji.png" },
    { name: "France", lat: 46.2276, lng: 2.2137, flag: "https://img.icons8.com/emoji/48/france-emoji.png" },
    { name: "Germany", lat: 51.1657, lng: 10.4515, flag: "https://img.icons8.com/emoji/48/germany-emoji.png" },
    { name: "Hong Kong", lat: 22.3193, lng: 114.1694, flag: "https://img.icons8.com/emoji/48/hong-kong-sar-china-emoji.png" },
    { name: "Hungary", lat: 47.1625, lng: 19.5033, flag: "https://img.icons8.com/emoji/48/hungary-emoji.png" },
    { name: "India", lat: 20.5937, lng: 78.9629, flag: "https://img.icons8.com/emoji/48/india-emoji.png" },
    { name: "Indonesia", lat: -0.7893, lng: 113.9213, flag: "https://img.icons8.com/emoji/48/indonesia-emoji.png" },
    { name: "Iran", lat: 32.4279, lng: 53.6880, flag: "https://img.icons8.com/emoji/48/iran-emoji.png" },
    { name: "Japan", lat: 36.2048, lng: 138.2529, flag: "https://img.icons8.com/emoji/48/japan-emoji.png" },
    { name: "Kazakhstan", lat: 48.0196, lng: 66.9237, flag: "https://img.icons8.com/emoji/48/kazakhstan-emoji.png" },
    { name: "Laos", lat: 19.8563, lng: 102.4955, flag: "https://img.icons8.com/emoji/48/laos-emoji.png" },
    { name: "Luxembourg", lat: 49.8153, lng: 6.1296, flag: "https://img.icons8.com/emoji/48/luxembourg-emoji.png" },
    { name: "Malaysia", lat: 4.2105, lng: 101.9758, flag: "https://img.icons8.com/emoji/48/malaysia-emoji.png" },
    { name: "Mozambique", lat: -18.6657, lng: 35.5296, flag: "https://img.icons8.com/emoji/48/mozambique-emoji.png" },
    { name: "Myanmar", lat: 21.9162, lng: 95.9560, flag: "https://img.icons8.com/emoji/48/myanmar-burma-emoji.png" },
    { name: "Netherlands", lat: 52.1326, lng: 5.2913, flag: "https://img.icons8.com/emoji/48/netherlands-emoji.png" },
    { name: "North Korea", lat: 40.3399, lng: 127.5101, flag: "https://img.icons8.com/emoji/48/north-korea-emoji.png" },
    { name: "South Korea", lat: 35.9078, lng: 127.7669, flag: "https://img.icons8.com/emoji/48/south-korea-emoji.png" },
    { name: "Philippines", lat: 12.8797, lng: 121.7740, flag: "https://img.icons8.com/emoji/48/philippines-emoji.png" },
    { name: "Pakistan", lat: 30.3753, lng: 69.3451, flag: "https://img.icons8.com/emoji/48/pakistan-emoji.png" },
    { name: "Mongolia", lat: 46.8625, lng: 103.8467, flag: "https://img.icons8.com/emoji/48/mongolia-emoji.png" },
    { name: "Poland", lat: 51.9194, lng: 19.1451, flag: "https://img.icons8.com/emoji/48/poland-emoji.png" },
    { name: "Qatar", lat: 25.3548, lng: 51.1839, flag: "https://img.icons8.com/emoji/48/qatar-emoji.png" },
    { name: "Russia", lat: 61.5240, lng: 105.3188, flag: "https://img.icons8.com/emoji/48/russia-emoji.png" },
    { name: "Singapore", lat: 1.3521, lng: 103.8198, flag: "https://img.icons8.com/emoji/48/singapore-emoji.png" },
    { name: "Sweden", lat: 60.1282, lng: 18.6435, flag: "https://img.icons8.com/emoji/48/sweden-emoji.png" },
    { name: "Switzerland", lat: 46.8182, lng: 8.2275, flag: "https://img.icons8.com/emoji/48/switzerland-emoji.png" },
    { name: "Taiwan", lat: 23.6978, lng: 120.9605, flag: "https://img.icons8.com/emoji/48/taiwan-emoji.png" },
    { name: "Thailand", lat: 15.8700, lng: 100.9925, flag: "https://img.icons8.com/emoji/48/thailand-emoji.png" },
    { name: "United Arab Emirates", lat: 23.4241, lng: 53.8478, flag: "https://img.icons8.com/emoji/48/united-arab-emirates-emoji.png" }
  ];

  // Initialize config to EXACT flags
  let iconConfig = {};
  iconConfig[origin.name] = origin.flag;
  countries.forEach(c => iconConfig[c.name] = c.flag);
  const savedRaw = localStorage.getItem(STORAGE_KEY);
  if (savedRaw) {
    try { Object.assign(iconConfig, JSON.parse(savedRaw)); } catch(_) {}
  }

  // Leaflet map (colored, no labels)
  const map = L.map('map', { zoomControl: true });
  L.tileLayer(
    'https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png',
    { attribution: '&copy; OpenStreetMap & CARTO', maxZoom: 19 }
  ).addTo(map);

  // Helper: DivIcon with <img> + graceful fallback
  function makeDivIcon(url) {
    const safe = (url || '').replace(/"/g, '&quot;');
    const html = `<img src="${safe}" onerror="this.onerror=null; this.src='https://cdn0.iconfinder.com/data/icons/basic-14/614/43_-_Iocation-1024.png';" />`;
    return L.divIcon({ html, className: 'flag-icon', iconSize: [28,28], iconAnchor: [14,28] });
  }

  // Origin marker + red label above
  const originMarker = L.marker([origin.lat, origin.lng], { icon: makeDivIcon(iconConfig[origin.name]) }).addTo(map);
  originMarker.bindTooltip(origin.name, { permanent: true, direction: 'top', offset: [0, -28], className: 'origin-label' }).openTooltip();

  const markers = {};
  const bounds = L.latLngBounds([ [origin.lat, origin.lng] ]);

  // Quad Bezier curve
  function bezier(a, b, lift=0.16, steps=100) {
    const mlat = (a[0] + b[0]) / 2, mlng = (a[1] + b[1]) / 2;
    const dx = b[1] - a[1], dy = b[0] - a[0];
    const len = Math.sqrt(dx*dx + dy*dy) + 1e-9;
    const nx = -dy/len, ny = dx/len;
    const k = lift * len;
    const clat = mlat + ny*k, clng = mlng + nx*k;
    const pts = [];
    for (let i=0;i<=steps;i++) {
      const t = i/steps;
      const lat = (1-t)*(1-t)*a[0] + 2*(1-t)*t*clat + t*t*b[0];
      const lng = (1-t)*(1-t)*a[1] + 2*(1-t)*t*clng + t*t*b[1];
      pts.push([lat, lng]);
    }
    return pts;
  }

  // Add countries and dashed curves
  countries.forEach(c => {
    const m = L.marker([c.lat, c.lng], { icon: makeDivIcon(iconConfig[c.name]) }).addTo(map);
    m.bindTooltip(c.name, { permanent: true, direction: 'top', offset: [0, -28], className: 'dest-label' }).openTooltip();
    markers[c.name] = m;
    bounds.extend([c.lat, c.lng]);
    const pts = bezier([origin.lat, origin.lng], [c.lat, c.lng], 0.16, 120);
    L.polyline(pts, { color: "#1e88e5", weight: 2.3, opacity: 0.95, dashArray: "8,10" }).addTo(map);
  });

  map.fitBounds(bounds.pad(0.08));

  // ------- Panel with toggle & editing -------
  const PANEL_KEY = "panelCollapsed";
  const panel = document.getElementById('panel');
  const toggleBtn = document.getElementById('togglePanel');
  function setPanelState(collapsed) {
    if (collapsed) { panel.classList.add('hidden'); toggleBtn.textContent = "Show list ▾"; }
    else { panel.classList.remove('hidden'); toggleBtn.textContent = "Hide list ▴"; }
    localStorage.setItem(PANEL_KEY, collapsed ? "1" : "0");
  }
  const wasCollapsed = localStorage.getItem(PANEL_KEY) === "1";
  setPanelState(wasCollapsed);
  toggleBtn.addEventListener('click', () => setPanelState(!panel.classList.contains('hidden')));

  const inputsDiv = document.getElementById('inputs');
  function renderInputs() {
    inputsDiv.innerHTML = '';
    // Vietnam first
    const vnRow = document.createElement('div'); vnRow.className = 'row';
    const vnLabel = document.createElement('label'); vnLabel.textContent = origin.name;
    const vnInput = document.createElement('input'); vnInput.type = 'text'; vnInput.value = iconConfig[origin.name];
    vnInput.id = 'input-' + origin.name.replace(/\s+/g,'_');
    vnRow.appendChild(vnLabel); vnRow.appendChild(vnInput); inputsDiv.appendChild(vnRow);
    // Countries
    countries.forEach(c => {
      const row = document.createElement('div'); row.className = 'row';
      const label = document.createElement('label'); label.textContent = c.name;
      const input = document.createElement('input'); input.type = 'text';
      input.value = iconConfig[c.name] || c.flag;
      input.id = 'input-' + c.name.replace(/\s+/g,'_');
      row.appendChild(label); row.appendChild(input); inputsDiv.appendChild(row);
    });
  }
  renderInputs();

  function applyChanges() {
    // Vietnam
    let id = 'input-' + origin.name.replace(/\s+/g,'_');
    let val = document.getElementById(id).value.trim() || origin.flag;
    iconConfig[origin.name] = val;
    originMarker.setIcon(makeDivIcon(val));

    // Countries
    countries.forEach(c => {
      const id = 'input-' + c.name.replace(/\s+/g,'_');
      const val = document.getElementById(id).value.trim() || c.flag;
      iconConfig[c.name] = val;
      markers[c.name].setIcon(makeDivIcon(val));
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(iconConfig));
  }

  function resetConfig() {
    iconConfig = {}; iconConfig[origin.name] = origin.flag;
    countries.forEach(c => iconConfig[c.name] = c.flag);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(iconConfig));
    renderInputs(); applyChanges();
  }

  document.getElementById('applyBtn').onclick = applyChanges;
  document.getElementById('resetBtn').onclick = resetConfig;
  document.getElementById('exportBtn').onclick = () => {
    const box = document.getElementById('exportBox'); box.style.display = 'block';
    box.value = JSON.stringify(iconConfig, null, 2); box.select();
  };

  // ------- Text label toggle -------
  const toggleLabelsBtn = document.getElementById('toggleLabelsBtn');
  function setLabelsHidden(hidden) {
    document.body.classList.toggle('labels-off', hidden);
    toggleLabelsBtn.textContent = hidden ? 'Show labels' : 'Hide labels';
    localStorage.setItem(LABELS_KEY, hidden ? '1' : '0');
  }
  const labelsHidden = localStorage.getItem(LABELS_KEY) === '1';
  setLabelsHidden(labelsHidden);
  toggleLabelsBtn.addEventListener('click', () => setLabelsHidden(!document.body.classList.contains('labels-off')));
</script>
</body>
</html>
